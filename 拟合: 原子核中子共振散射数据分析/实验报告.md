# 原子核中子共振散射数据分析与拟合 - 实验报告

## 1. 实验目的

本实验旨在通过分析原子核中子的共振散射实验数据，掌握Breit-Wigner共振公式拟合的基本方法。具体目标包括：

- 理解Breit-Wigner共振公式的物理意义
- 掌握使用`scipy.optimize.curve_fit`进行数据拟合的方法
- 比较考虑误差和不考虑误差两种拟合方法的结果差异
- 学习科学数据的可视化表示方法

## 2. 方法简述

请简要描述你实现各个任务的方法和思路，特别是：

首先，在Breit-Wigner共振公式的实现上，我通过编写一个函数 breit_wigner(E, Er, Gamma, fr) 来表达共振截面的能量依赖关系。公式中，Er 是共振能量中心，Gamma 是共振宽度，fr 是共振强度因子。具体形式是将 Gamma 的平方除以四，再放在分母平方差项中，从而构造出具有共振峰的函数。这个函数可以处理单个能量值，也能接受能量数组进行批量计算，适用于后续拟合和绘图。

在拟合方法方面，我实现了两种思路：

第一种是“未考虑误差的拟合”，即直接将能量和对应的截面数据传入 scipy.optimize.curve_fit() 中进行非线性最小二乘拟合。这种方法默认每个数据点的权重相同，主要用于粗略拟合。

第二种是“考虑误差的拟合”，在调用 curve_fit 时传入实验数据的不确定性数组（errors）作为 sigma 参数，并设置 absolute_sigma=True，确保拟合输出的参数协方差具有实际物理意义。这种方法更符合实验数据的处理规范，能够反映各数据点的测量精度对拟合结果的影响。

误差处理方面，除了在拟合中作为加权因素，还通过拟合结果的协方差矩阵提取参数的不确定度。具体做法是提取协方差矩阵对角线元素的平方根，作为 Er、Gamma 和 fr 的标准差。这些误差可以乘以1.96，用来表示拟合参数的95%置信区间。

在可视化方面，我使用 matplotlib 进行绘图。主要步骤包括：首先用 errorbar 函数绘制原始实验数据点和其误差条；然后生成平滑的能量数组，利用拟合得到的参数计算拟合曲线，并用 plot 函数绘制；最后在图中添加图例、标题、坐标轴标签，以及用文字注释拟合参数及其误差，确保图像既美观又具有科学解释力。

## 3. 实验结果

### 3.1 不考虑误差的拟合结果

请在此处填写不考虑误差的拟合结果：
Er = 77.5 ± 1.4 MeV (95% CI)
Γ = 56.2 ± 3.5 MeV (95% CI)
fr = 66886 ± 6740 (95% CI)

### 3.2 考虑误差的拟合结果

请在此处填写考虑误差的拟合结果：
Er = 78.2 ± 25.1 MeV (95% CI)
Γ = 59.2 ± 65.9 MeV (95% CI)
fr = 70878 ± 67533 (95% CI)


### 3.4 拟合曲线图

请在此处插入你绘制的拟合曲线图(两种方法各一张)。图表应包含以下元素：

- 数据点(带误差棒)
- 最佳拟合曲线
- 图表标题："Breit-Wigner Fit (With/Without Errors)"
- X轴标签："Energy (MeV)"
- Y轴标签："Cross Section (mb)"
- 图例，包括数据点和拟合曲线的说明
- 拟合参数及其误差的标注
![image](https://github.com/user-attachments/assets/2693d3f0-5759-4091-84e9-01c49cb31195)
![image](https://github.com/user-attachments/assets/efd8f6c5-1531-45e1-b914-9904bb544f6c)


### 3.5 核心代码片段

请在此处粘贴你实现的关键代码片段：

```python
def fit_without_errors(energy, cross_section):
    """
    不考虑误差的Breit-Wigner拟合
    """
    Er_guess = 75.0
    Gamma_guess = 50.0
    fr_guess = 10000.0
    popt, pcov = curve_fit(breit_wigner, energy, cross_section,
                        p0=[Er_guess, Gamma_guess, fr_guess])
    return popt, pcov

def fit_with_errors(energy, cross_section, errors):
    """
    考虑误差的Breit-Wigner拟合
    """
    Er_guess = 75.0
    Gamma_guess = 50.0
    fr_guess = 10000.0
    popt, pcov = curve_fit(breit_wigner, energy, cross_section,
                        sigma=errors, absolute_sigma=True,
                        p0=[Er_guess, Gamma_guess, fr_guess])
    return popt, pcov
def plot_fit_results(energy, cross_section, errors, popt, pcov, title):
    """
    绘制拟合结果
    
    参数:
        energy (numpy.ndarray): 能量数据
        cross_section (numpy.ndarray): 截面数据
        errors (numpy.ndarray): 误差数据
        popt (array): 拟合参数
        pcov (2D array): 协方差矩阵
        title (str): 图表标题
    """
    plt.figure(figsize=(10, 6))
    
    # 绘制数据点
    plt.errorbar(energy, cross_section, yerr=errors, fmt='o', 
                color='blue', markersize=5, ecolor='gray',
                elinewidth=1, capsize=2, label='Experimental Data')
    
    # 绘制拟合曲线
    E_fit = np.linspace(min(energy), max(energy), 500)
    cross_section_fit = breit_wigner(E_fit, *popt)
    plt.plot(E_fit, cross_section_fit, '-', color='red', 
            linewidth=2, label='Fitted Curve')
    
    # 添加参数信息
    Er, Gamma, fr = popt
    Er_std = np.sqrt(pcov[0, 0])
    Gamma_std = np.sqrt(pcov[1, 1])
    fr_std = np.sqrt(pcov[2, 2])
    
    plt.text(0.05, 0.95, 
            f'$E_r$ = {Er:.1f} ± {1.96*Er_std:.1f} MeV (95% CI)\n'
            f'$\Gamma$ = {Gamma:.1f} ± {1.96*Gamma_std:.1f} MeV (95% CI)\n'
            f'$f_r$ = {fr:.0f} ± {1.96*fr_std:.0f} (95% CI)',
            transform=plt.gca().transAxes, 
            verticalalignment='top',
            bbox=dict(boxstyle='round', facecolor='white', alpha=0.8))
    
    plt.xlabel('Energy (MeV)')
    plt.ylabel('Cross Section (mb)')
    plt.title(title)
    plt.legend()
    plt.grid(True, linestyle='--', alpha=0.7)
    plt.tight_layout()
    
    return plt.gcf()
```

## 4. 分析与讨论
### 4.1 拟合结果比较
请比较两种拟合方法得到的参数差异，分析误差处理对拟合结果的影响。
从拟合参数的数值来看，考虑误差的拟合结果与不考虑误差相比通常会有如下特点：

共振能量 Er：不考虑误差时，拟合结果更容易受到误差大的点的影响，导致拟合曲线可能在整个数据区间中“折中”地通过所有点，从而使 Er 偏离真实峰值位置。考虑误差后，权重集中在误差小的高置信度数据点上，使得 Er 更接近真实共振峰位置。

共振宽度 Gamma：由于未考虑误差时低精度数据对拟合的影响较大，Gamma 容易被错误地加宽或压窄，以适应这些点。而考虑误差后，拟合主要受误差较小数据点控制，Gamma 更准确地反映实际的共振峰宽度。

强度 fr：在不加权的拟合中，如果某些点的截面值偏高且误差又较大，会使拟合强度 fr 被抬高。考虑误差后，这些高误差点的影响减弱，拟合结果的 fr 更可信。

误差处理对拟合的总体影响如下：

一，拟合更稳健：通过给每个点指定权重（即误差的倒数平方），curve_fit 会自动降低误差大的数据点对整体拟合结果的影响，从而避免异常点的干扰。

二，参数误差估计更准确：带误差拟合得到的协方差矩阵反映了每个参数的不确定性，并可用于计算可信区间。在没有误差输入的情况下，拟合得到的协方差矩阵假定每个点精度相等，这在实验数据中通常不成立。

三，物理解释更合理：考虑误差的拟合结果在图像上更贴合高质量数据区域，参数的置信区间也更具统计意义

### 4.2 误差分析
一、数据本身的测量误差：

仪器精度限制：探测器在测量能量或截面时存在固有的分辨率限制，例如能量通道宽度有限、响应曲线不完美等。

统计波动：尤其是在粒子物理或核物理实验中，某些能区可能只有少量事件被探测到，导致统计误差较大。

背景噪声：实验环境中存在本底辐射或其他反应过程的干扰，可能在信号上叠加虚假成分，影响拟合的真实性。

校准误差：能谱或截面的标定可能存在系统误差，例如能量刻度不准、归一化系数不正确，导致整体曲线偏移或变形。

二、拟合算法的局限性：

初始猜测依赖性：非线性拟合（如curve_fit）对初始参数较为敏感，初值设置不当可能导致局部最小而非全局最优解。

权重处理方式：如果未正确使用测量误差（sigma）参数进行加权拟合，低置信度数据将与高置信度数据被一视同仁，降低结果可信度。

共变参数：多个拟合参数之间可能存在高度相关性（如Er与Gamma），使得协方差矩阵病态，误差放大，增加不确定性。

三、模型假设的合理性：

模型简化过度：Breit-Wigner公式本质是单一共振态的理想描述，假设背景为零，适用于宽度较小的清晰共振峰。若实际过程中存在多个共振、干涉项或非共振背景（如直接反应贡献），则模型不再充分。

参数恒定假设：模型通常假设Γ和fr为常数，但在复杂实验中，它们可能随能量轻微变化（例如能量相关宽度），这在Breit-Wigner中未体现。

不考虑外部影响：如束流能量扩展、靶厚度引起的能量分布拉宽、探测效率非均匀性等，都会导致实际数据偏离模型预期。

### 4.3 思考题
1. 考虑误差的拟合方法在什么情况下特别重要？为什么？
   一、数据误差不均匀时：

当不同数据点的测量误差大小差异显著（如某些点误差很大，某些点很小），若不加权拟合，所有数据点对拟合结果的贡献是一样的，这会导致低精度数据对结果产生不合理的影响，降低拟合参数的准确性和可信度。加权拟合能使高置信度的数据占主导地位，提高结果的统计意义。

二、精确提取物理参数时：

在需要从实验数据中精确提取物理意义明确的参数（如共振质量和宽度）时，考虑误差是必须的。未加权的拟合可能导致系统性偏差，使最终参数与真实物理量不符，尤其在高精度实验（如粒子物理、核谱测量）中影响显著。

三、拟合结果需用于后续推理或不确定度传播时：

如果拟合参数及其误差要作为后续计算或模型输入的一部分（例如用于计算反应截面或估计物理常数），那么不考虑误差的拟合将低估或错误估计不确定性，从而影响整个研究链条的可靠性。

四、数据质量整体较低或采样点较少时：

当实验数据点较少或质量不高时，更需要充分利用每个数据点的置信信息。加权拟合能够避免个别低质量数据对整体结果的干扰，使拟合更稳健。
2. 如何评估拟合结果的可靠性？有哪些统计指标可以帮助判断拟合质量？
一、残差分析：

残差是指数据点与拟合曲线之间的差值。通过分析残差的行为，可以评估拟合的质量。理想情况下，残差应随机分布在零附近。如果残差显示出系统性的模式（如趋势或周期性），则可能表明模型不适合数据，或者存在未考虑的因素。

标准化残差：标准化残差是指残差除以每个数据点的标准差（或误差）。标准化残差可以帮助识别不合适的数据点，尤其是那些具有显著较大残差的数据点。标准化残差绝对值大于3通常被视为异常点。

残差平方和（RSS）：通过计算残差的平方和，可以衡量模型与数据之间的差距。较小的RSS值通常意味着较好的拟合。

二、拟合优度（Goodness of Fit）：

R²值（决定系数）：R²值衡量模型解释数据变异的程度，取值范围在0到1之间。值越接近1，说明模型越好地拟合数据。R²越大，表示模型越能够解释数据中的变化。

调整后的R²（Adjusted R²）：调整后的R²在考虑模型复杂度的同时评估拟合质量。它在R²的基础上惩罚过度拟合，特别是在有多个参数时，调整后的R²比R²更能真实反映模型的拟合效果。

## 5. 结论
Breit-Wigner共振公式的应用：

理论与实践的结合：Breit-Wigner共振公式在物理学中广泛应用于描述粒子物理中共振现象，如核反应中的能量分布等。通过本次实验，成功地将这一理论模型应用于实验数据的拟合，并且能够准确地提取出共振能量、共振宽度和共振强度等重要物理量。

参数的物理意义：通过拟合得到的参数（共振能量Er、共振宽度Gamma和共振强度fr），我们能够更好地理解实验数据背后的物理过程。例如，共振能量Er代表了反应发生的峰值位置，而Gamma则与共振的宽度和不确定性相关，fr则反映了反应的强度。

模型拟合的有效性：尽管Breit-Wigner公式在核物理实验中应用广泛，但在一些情况下，它可能并不是唯一的描述方法。因此，理解模型的假设和适用范围非常重要，实验中应当评估模型与数据的匹配度，确保使用正确的公式进行拟合。

误差处理对拟合结果的影响：

误差的显著作用：在本次实验中，通过比较不考虑误差和考虑误差的两种拟合方法，我们发现误差的考虑对拟合结果有重要影响。特别是在拟合参数的不确定性较大时，误差的引入能够显著改善拟合结果的准确性和可靠性。对于实验中误差较大的数据点，考虑误差后得到的拟合结果往往更加真实反映了实验的不确定性。

提高拟合精度：在没有误差的情况下，拟合结果可能过于乐观，忽略了实验数据中的误差来源。而在考虑误差的情况下，拟合过程能够自动调整参数权重，给出更为精确的拟合参数及其不确定性。这对于高精度的实验尤为重要，因为不考虑误差的拟合可能导致对数据的过度拟合或忽视潜在的系统误差。

误差对参数的影响：在误差较大的数据点处，拟合参数的标准误差会增加，从而导致拟合结果的不确定性增大。通过引入误差，可以避免对这些数据点的过度依赖，使得拟合结果更具可靠性。

误差源的识别与分析：

测量误差：实验数据中的误差可能来源于多种因素，如测量仪器的不准确性、数据采集时的环境因素（如温度、湿度的变化）等。这些误差如果未被合理考虑，可能会导致拟合结果的偏差。

拟合算法的局限性：尽管曲线拟合方法如Breit-Wigner拟合在很多情况下表现良好，但当数据分布较为复杂或模型假设不完全符合实际时，拟合结果可能并不理想。因此，拟合结果不仅要依赖于算法本身，还要考虑到模型的适用性和实验数据的特点。

模型假设的合理性：Breit-Wigner公式假设共振现象呈现对称的Lorentz型曲线，并且能量分布符合这一形式。然而在实际实验中，可能由于其他物理效应的影响（如多重散射、系统误差等），数据并不完全符合这一假设。因此，在使用该模型时，需要不断验证其适用性和合理性。

## 6. 参考文献
请列出你在实验过程中参考的文献、书籍或网站。(可选)
